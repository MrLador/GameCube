<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Пинпонг</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Press Start 2P', cursive;
      color: #eee;
      user-select: none;
    }
    h1 {
      margin: 20px 0 10px;
      text-shadow:
        1px 1px 0 #000,
        2px 2px 0 #555;
    }
    canvas {
      background: #000;
      image-rendering: pixelated;
      border: 4px solid #000;
      box-shadow:
        inset 2px 2px 0 #fff,
        inset -2px -2px 0 #555;
      margin-bottom: 20px;
    }
    .instructions {
      font-size: 0.7rem;
      max-width: 400px;
      text-align: center;
      line-height: 1.3;
      color: #ccc;
      margin-bottom: 40px;
    }
    a.back-link {
      color: #eee;
      text-decoration: none;
      border: 3px solid #000;
      padding: 10px 20px;
      background: #c0c0c0;
      box-shadow:
        inset 2px 2px 0 #fff,
        inset -2px -2px 0 #888;
      transition: background 0.15s ease;
      font-size: 0.75rem;
    }
    a.back-link:hover {
      background: #e0e0e0;
    }
  </style>
</head>
<body>
  <h1>Пинпонг</h1>
  <canvas id="game" width="640" height="400"></canvas>
  <div class="instructions">
    Управление:<br />
    Левая ракетка — клавиши W (вверх) и S (вниз)<br />
    Правая ракетка — стрелки ↑ и ↓
  </div>
  <a href="index.html" class="back-link">← Назад в меню</a>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Размеры
    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    // Ракетки
    const PADDLE_WIDTH = 10;
    const PADDLE_HEIGHT = 80;
    const PADDLE_SPEED = 6;

    // Мяч
    const BALL_SIZE = 12;
    const BALL_SPEED = 5;

    // Игроки
    const leftPaddle = {
      x: 10,
      y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
      dy: 0,
    };

    const rightPaddle = {
      x: WIDTH - PADDLE_WIDTH - 10,
      y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
      dy: 0,
    };

    const ball = {
      x: WIDTH / 2 - BALL_SIZE / 2,
      y: HEIGHT / 2 - BALL_SIZE / 2,
      dx: BALL_SPEED,
      dy: BALL_SPEED,
    };

    let leftScore = 0;
    let rightScore = 0;

    // Управление
    const keys = {};

    window.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    function resetBall() {
      ball.x = WIDTH / 2 - BALL_SIZE / 2;
      ball.y = HEIGHT / 2 - BALL_SIZE / 2;
      // Направление случайное
      ball.dx = BALL_SPEED * (Math.random() < 0.5 ? 1 : -1);
      ball.dy = BALL_SPEED * (Math.random() * 2 - 1);
    }

    function update() {
      // Движение ракеток
      if (keys['w']) {
        leftPaddle.y -= PADDLE_SPEED;
      }
      if (keys['s']) {
        leftPaddle.y += PADDLE_SPEED;
      }
      if (keys['arrowup']) {
        rightPaddle.y -= PADDLE_SPEED;
      }
      if (keys['arrowdown']) {
        rightPaddle.y += PADDLE_SPEED;
      }

      // Ограничение ракеток по экрану
      leftPaddle.y = Math.max(0, Math.min(HEIGHT - PADDLE_HEIGHT, leftPaddle.y));
      rightPaddle.y = Math.max(0, Math.min(HEIGHT - PADDLE_HEIGHT, rightPaddle.y));

      // Движение мяча
      ball.x += ball.dx;
      ball.y += ball.dy;

      // Отскок от верхнего и нижнего края
      if (ball.y <= 0 || ball.y + BALL_SIZE >= HEIGHT) {
        ball.dy = -ball.dy;
      }

      // Проверка столкновения с ракетками
      if (
        ball.x <= leftPaddle.x + PADDLE_WIDTH &&
        ball.x >= leftPaddle.x &&
        ball.y + BALL_SIZE >= leftPaddle.y &&
        ball.y <= leftPaddle.y + PADDLE_HEIGHT
      ) {
        ball.dx = -ball.dx;
        // Немного меняем угол отскока в зависимости от места удара
        let collidePoint = (ball.y + BALL_SIZE / 2) - (leftPaddle.y + PADDLE_HEIGHT / 2);
        ball.dy = collidePoint * 0.25;
        ball.x = leftPaddle.x + PADDLE_WIDTH; // чтобы не застрял в ракетке
      }

      if (
        ball.x + BALL_SIZE >= rightPaddle.x &&
        ball.x + BALL_SIZE <= rightPaddle.x + PADDLE_WIDTH &&
        ball.y + BALL_SIZE >= rightPaddle.y &&
        ball.y <= rightPaddle.y + PADDLE_HEIGHT
      ) {
        ball.dx = -ball.dx;
        let collidePoint = (ball.y + BALL_SIZE / 2) - (rightPaddle.y + PADDLE_HEIGHT / 2);
        ball.dy = collidePoint * 0.25;
        ball.x = rightPaddle.x - BALL_SIZE; // чтобы не застрял в ракетке
      }

      // Голы
      if (ball.x < 0) {
        rightScore++;
        resetBall();
      }
      if (ball.x + BALL_SIZE > WIDTH) {
        leftScore++;
        resetBall();
      }
    }

    function drawRect(x, y, w, h, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x, y, w, h);
    }

    function drawCircle(x, y, r, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawNet() {
      const netWidth = 4;
      const netHeight = 20;
      const netColor = '#eee';
      for (let i = 0; i < HEIGHT; i += netHeight * 2) {
        drawRect(WIDTH / 2 - netWidth / 2, i, netWidth, netHeight, netColor);
      }
    }

    function drawText(text, x, y, size = 20, color = '#eee') {
      ctx.fillStyle = color;
      ctx.font = `${size}px 'Press Start 2P', cursive`;
      ctx.textAlign = 'center';
      ctx.fillText(text, x, y);
    }

    function draw() {
      // Очистка
      drawRect(0, 0, WIDTH, HEIGHT, '#000');

      // Сетка
      drawNet();

      // Ракетки
      drawRect(leftPaddle.x, leftPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT, '#eee');
      drawRect(rightPaddle.x, rightPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT, '#eee');

      // Мяч
      drawRect(ball.x, ball.y, BALL_SIZE, BALL_SIZE, '#eee');

      // Счёт
      drawText(leftScore, WIDTH / 4, 40, 32);
      drawText(rightScore, WIDTH * 3 / 4, 40, 32);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    resetBall();
    gameLoop();
  </script>
</body>
</html>
