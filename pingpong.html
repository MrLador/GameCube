<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Monument Valley Inspired Game — Принцесса Ида</title>
<style>
  /* Сброс */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    background: linear-gradient(135deg, #a0c4ff, #caf0f8);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    overflow: hidden;
  }
  #game-container {
    width: 90vmin;
    height: 90vmin;
    max-width: 600px;
    max-height: 600px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    position: relative;
  }
  svg {
    width: 100%;
    height: 100%;
    display: block;
  }
  /* Лабиринт */
  .maze-part {
    fill: url(#gradMaze);
    stroke: #333;
    stroke-width: 2;
    filter: drop-shadow(1px 2px 2px rgba(0,0,0,0.1));
    transition: transform 1s ease;
    transform-origin: center center;
  }
  /* Персонаж - Принцесса Ида */
  .ida-body {
    fill: url(#gradIdaBody);
    stroke: #b00020;
    stroke-width: 2;
    filter: drop-shadow(0 0 5px rgba(255, 89, 94, 0.8));
  }
  .ida-crown {
    fill: gold;
    stroke: #b8860b;
    stroke-width: 1.5;
  }
  /* Подсказки */
  #info {
    position: absolute;
    bottom: 10px;
    width: 100%;
    text-align: center;
    font-size: 1rem;
    color: #555;
    user-select: none;
  }
  @media (max-width: 600px) {
    #info {
      font-size: 1.2rem;
      padding: 0 10px;
    }
  }
</style>
</head>
<body>

<div id="game-container" role="main" aria-label="Игра Принцесса Ида в стиле Monument Valley">
  <svg viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" id="gameSVG" aria-hidden="true" focusable="false">
    <defs>
      <!-- Градиенты -->
      <linearGradient id="gradMaze" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#ffd6a5" />
        <stop offset="100%" stop-color="#fdffb6" />
      </linearGradient>
      <radialGradient id="gradIdaBody" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#ff595e" />
        <stop offset="100%" stop-color="#b00020" />
      </radialGradient>
    </defs>

    <!-- Лабиринт: 3 части, которые можно поворачивать -->
    <g id="maze-part-1" class="maze-part" transform="translate(50 50)">
      <rect x="0" y="0" width="80" height="80" />
      <polygon points="0,0 80,0 80,10 10,10 10,70 0,70" fill="#fca311" />
    </g>
    <g id="maze-part-2" class="maze-part" transform="translate(130 50)">
      <rect x="0" y="0" width="80" height="80" />
      <polygon points="0,0 80,0 80,80 70,80 70,10 0,10" fill="#e85d04" />
    </g>
    <g id="maze-part-3" class="maze-part" transform="translate(90 130)">
      <rect x="0" y="0" width="100" height="100" />
      <polygon points="0,0 100,0 100,100 90,100 90,20 0,20" fill="#faa307" />
    </g>

    <!-- Персонаж: Принцесса Ида -->
    <g id="ida" aria-label="Принцесса Ида" role="img" tabindex="0" transform="translate(60 60)">
      <circle class="ida-body" cx="0" cy="0" r="10" />
      <polygon class="ida-crown" points="-6,-10 0,-20 6,-10" />
    </g>
  </svg>

  <div id="info" aria-live="polite"></div>
</div>

<script>
  (() => {
    const ida = document.getElementById('ida');
    const info = document.getElementById('info');
    const mazeParts = [
      document.getElementById('maze-part-1'),
      document.getElementById('maze-part-2'),
      document.getElementById('maze-part-3')
    ];

    // Позиции персонажа в лабиринте (x, y) и индекс части лабиринта
    const positions = [
      { part: 0, x: 20, y: 20 },
      { part: 0, x: 60, y: 20 },
      { part: 1, x: 20, y: 20 },
      { part: 1, x: 60, y: 60 },
      { part: 2, x: 40, y: 40 },
      { part: 2, x: 80, y: 80 }
    ];
    let posIndex = 0;

    // Определение устройства
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // Обновление подсказок
    function updateInfo() {
      if (isMobile) {
        info.textContent = 'Свайпайте влево/вправо для поворота частей лабиринта, вверх/вниз — для перемещения Иды';
      } else {
        info.textContent = 'Стрелки ←/→ — поворот лабиринта, ↑/↓ — перемещение Иды';
      }
    }
    updateInfo();

    // Текущие углы поворота частей лабиринта
    const rotations = [0, 0, 0];

    // Функция поворота части лабиринта
    function rotatePart(index, direction) {
      rotations[index] = (rotations[index] + direction * 90) % 360;
      mazeParts[index].style.transform = `translate(${mazeParts[index].getAttribute('transform').match(/translate\(([^)]+)\)/)[1]}) rotate(${rotations[index]}deg)`;
    }

    // Функция перемещения Иды
    function moveIda(direction) {
      // direction: 1 - вперед, -1 - назад
      let newIndex = posIndex + direction;
      if (newIndex < 0 || newIndex >= positions.length) return;
      posIndex = newIndex;
      const pos = positions[posIndex];
      // Перемещаем Иду в координаты внутри части лабиринта
      const part = mazeParts[pos.part];
      // Получаем трансформацию части лабиринта (translate)
      const translateMatch = part.getAttribute('transform').match(/translate\(([^)]+)\)/);
      const [tx, ty] = translateMatch[1].split(' ').map(Number);
      // Учитываем поворот части лабиринта
      const angle = rotations[pos.part];
      // Рассчитаем позицию Иды с учётом поворота
      let x = pos.x;
      let y = pos.y;
      // Поворот точки вокруг центра части (40,40) (центр 80x80 или 100x100)
      const centerX = part.querySelector('rect').getAttribute('width') / 2;
      const centerY = part.querySelector('rect').getAttribute('height') / 2;

      function rotatePoint(px, py, cx, cy, angleDeg) {
        const rad = angleDeg * Math.PI / 180;
        const cos = Math.cos(rad);
        const sin = Math.sin(rad);
        const dx = px - cx;
        const dy = py - cy;
        return {
          x: cx + dx * cos - dy * sin,
          y: cy + dx * sin + dy * cos
        };
      }
      const rotated = rotatePoint(x, y, centerX, centerY, angle);
      // Устанавливаем позицию Иды с учётом трансляции части лабиринта
      ida.setAttribute('transform', `translate(${tx + rotated.x} ${ty + rotated.y})`);
    }

    // Инициализация позиции Иды
    moveIda(0);

    // Управление с клавиатуры (ПК)
    if (!isMobile) {
      window.addEventListener('keydown', e => {
        switch(e.key) {
          case 'ArrowUp':
            moveIda(1);
            e.preventDefault();
            break;
          case 'ArrowDown':
            moveIda(-1);
            e.preventDefault();
            break;
          case 'ArrowLeft':
            rotatePart(0, -1);
            e.preventDefault();
            break;
          case 'ArrowRight':
            rotatePart(0, 1);
            e.preventDefault();
            break;
        }
      });
    }

    // Управление свайпами (мобильные)
    if (isMobile) {
      let touchStartX = null;
      let touchStartY = null;
      const threshold = 30;

      window.addEventListener('touchstart', e => {
        if (e.touches.length === 1) {
          touchStartX = e.touches[0].clientX;
          touchStartY = e.touches[0].clientY;
        }
      });

      window.addEventListener('touchend', e => {
        if (touchStartX === null || touchStartY === null) return;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const diffX = touchStartX - touchEndX;
        const diffY = touchStartY - touchEndY;

        if (Math.abs(diffX) > Math.abs(diffY)) {
          // Горизонтальный свайп — поворот лабиринта
          if (diffX > threshold) {
            rotatePart(0, 1);
          } else if (diffX < -threshold) {
            rotatePart(0, -1);
          }
        } else {
          // Вертикальный свайп — перемещение Иды
          if (diffY > threshold) {
            moveIda(1);
          } else if (diffY < -threshold) {
            moveIda(-1);
          }
        }
        touchStartX = null;
        touchStartY = null;
      });
    }
  })();
</script>

</body>
</html>
