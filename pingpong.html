<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Пинпонг</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Press Start 2P', cursive;
      color: #eee;
      user-select: none;
    }
    h1 {
      margin: 20px 0 10px;
      text-shadow:
        1px 1px 0 #000,
        2px 2px 0 #555;
    }
    canvas {
      background: #000;
      image-rendering: pixelated;
      border: 4px solid #000;
      box-shadow:
        inset 2px 2px 0 #fff,
        inset -2px -2px 0 #555;
      margin-bottom: 20px;
      display: block;
    }
    .instructions {
      font-size: 0.7rem;
      max-width: 400px;
      text-align: center;
      line-height: 1.3;
      color: #ccc;
      margin-bottom: 40px;
    }
    a.back-link {
      color: #eee;
      text-decoration: none;
      border: 3px solid #000;
      padding: 10px 20px;
      background: #c0c0c0;
      box-shadow:
        inset 2px 2px 0 #fff,
        inset -2px -2px 0 #888;
      transition: background 0.15s ease;
      font-size: 0.75rem;
    }
    a.back-link:hover {
      background: #e0e0e0;
    }
  </style>
</head>
<body>
  <h1>Пинпонг</h1>
  <canvas id="game" width="640" height="400"></canvas>
  <div class="instructions">
    Управление:<br />
    Ракетка — стрелки ↑ и ↓
  </div>
  <a href="index.html" class="back-link">← Назад в меню</a>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    const PADDLE_WIDTH = 10;
    const PADDLE_HEIGHT = 80;
    const PADDLE_SPEED = 6;

    const BALL_SIZE = 12;
    const BALL_SPEED = 5;

    // В игре одна ракетка — правая, управляемая стрелками
    const paddle = {
      x: WIDTH - PADDLE_WIDTH - 10,
      y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
      dy: 0,
      flashFrames: 0, // для эффекта вспышки
    };

    const ball = {
      x: WIDTH / 2 - BALL_SIZE / 2,
      y: HEIGHT / 2 - BALL_SIZE / 2,
      dx: BALL_SPEED,
      dy: BALL_SPEED,
    };

    let leftScore = 0;
    let rightScore = 0;

    const keys = {};

    window.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    function resetBall() {
      ball.x = WIDTH / 2 - BALL_SIZE / 2;
      ball.y = HEIGHT / 2 - BALL_SIZE / 2;
      ball.dx = BALL_SPEED * (Math.random() < 0.5 ? 1 : -1);
      ball.dy = BALL_SPEED * (Math.random() * 2 - 1);
    }

    // Эффекты вспышки для краёв
    const edgeFlash = {
      top: 0,
      bottom: 0,
      maxFrames: 6,
    };

    function update() {
      // Движение ракетки
      if (keys['arrowup']) {
        paddle.y -= PADDLE_SPEED;
      }
      if (keys['arrowdown']) {
        paddle.y += PADDLE_SPEED;
      }
      paddle.y = Math.max(0, Math.min(HEIGHT - PADDLE_HEIGHT, paddle.y));

      // Движение мяча
      ball.x += ball.dx;
      ball.y += ball.dy;

      // Отскок от верхнего и нижнего края
      if (ball.y <= 0) {
        ball.dy = -ball.dy;
        edgeFlash.top = edgeFlash.maxFrames;
      }
      if (ball.y + BALL_SIZE >= HEIGHT) {
        ball.dy = -ball.dy;
        edgeFlash.bottom = edgeFlash.maxFrames;
      }

      // Проверка столкновения с ракеткой
      if (
        ball.x + BALL_SIZE >= paddle.x &&
        ball.x + BALL_SIZE <= paddle.x + PADDLE_WIDTH &&
        ball.y + BALL_SIZE >= paddle.y &&
        ball.y <= paddle.y + PADDLE_HEIGHT
      ) {
        ball.dx = -ball.dx;
        // Угол отскока
        let collidePoint = (ball.y + BALL_SIZE / 2) - (paddle.y + PADDLE_HEIGHT / 2);
        ball.dy = collidePoint * 0.25;
        ball.x = paddle.x - BALL_SIZE; // чтобы не застрял
        paddle.flashFrames = 6; // включаем эффект вспышки ракетки
      }

      // Голы
      if (ball.x < 0) {
        rightScore++;
        resetBall();
      }
      if (ball.x > WIDTH) {
        leftScore++;
        resetBall();
      }

      // Уменьшаем счетчики эффектов
      if (paddle.flashFrames > 0) paddle.flashFrames--;
      if (edgeFlash.top > 0) edgeFlash.top--;
      if (edgeFlash.bottom > 0) edgeFlash.bottom--;
    }

    function drawRect(x, y, w, h, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x, y, w, h);
    }

    function drawNet() {
      const netWidth = 4;
      const netHeight = 20;
      const netColor = '#eee';
      for (let i = 0; i < HEIGHT; i += netHeight * 2) {
        drawRect(WIDTH / 2 - netWidth / 2, i, netWidth, netHeight, netColor);
      }
    }

    function drawText(text, x, y, size = 20, color = '#eee') {
      ctx.fillStyle = color;
      ctx.font = `${size}px 'Press Start 2P', cursive`;
      ctx.textAlign = 'center';
      ctx.fillText(text, x, y);
    }

    function draw() {
      // Очистка
      drawRect(0, 0, WIDTH, HEIGHT, '#000');

      // Сетка
      drawNet();

      // Края с эффектом вспышки
      if (edgeFlash.top > 0) {
        const alpha = edgeFlash.top / edgeFlash.maxFrames;
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.fillRect(0, 0, WIDTH, 5);
      }
      if (edgeFlash.bottom > 0) {
        const alpha = edgeFlash.bottom / edgeFlash.maxFrames;
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.fillRect(0, HEIGHT - 5, WIDTH, 5);
      }

      // Ракетка с эффектом вспышки
      if (paddle.flashFrames > 0) {
        const alpha = paddle.flashFrames / 6;
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.fillRect(paddle.x, paddle.y, PADDLE_WIDTH, PADDLE_HEIGHT);
      } else {
        drawRect(paddle.x, paddle.y, PADDLE_WIDTH, PADDLE_HEIGHT, '#eee');
      }

      // Мяч
      drawRect(ball.x, ball.y, BALL_SIZE, BALL_SIZE, '#eee');

      // Счёт
      drawText(leftScore, WIDTH / 4, 40, 32);
      drawText(rightScore, WIDTH * 3 / 4, 32, 32);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    resetBall();
    gameLoop();
  </script>
</body>
</html>
