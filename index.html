<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Пинпонг - Awesome Motorcycle Style</title>
<style>
  /* Сброс и базовые стили */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: #121212;
    color: #f0a500;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  h1 {
    margin: 0.5em 0 0.2em 0;
    font-weight: 900;
    letter-spacing: 0.1em;
  }
  #scoreboard {
    font-size: 2.5em;
    font-weight: 700;
    letter-spacing: 0.3em;
    margin: 0.2em 0 0.5em 0;
    text-align: center;
    color: #f0a500;
  }
  #modeSelect {
    margin-bottom: 0.5em;
  }
  #modeSelect button {
    background: transparent;
    border: 2px solid #f0a500;
    color: #f0a500;
    font-weight: 700;
    font-size: 1.2em;
    padding: 0.3em 1em;
    margin: 0 0.5em;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }
  #modeSelect button:hover, #modeSelect button:focus {
    background-color: #f0a500;
    color: #121212;
    outline: none;
  }
  #gameContainer {
    position: relative;
    width: 90vw;
    max-width: 900px;
    aspect-ratio: 16 / 9;
    background: #1e1e1e;
    border: 4px solid #f0a500;
    border-radius: 12px;
    box-shadow: 0 0 15px #f0a500aa;
  }
  canvas {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    background: #121212;
  }
  #info {
    margin-top: 0.5em;
    font-size: 1em;
    color: #f0a500cc;
    user-select: none;
  }
  /* Для мобильного управления: прозрачные зоны слева и справа */
  #touchLeft, #touchRight {
    position: fixed;
    top: 0; bottom: 0;
    width: 50vw;
    z-index: 10;
    touch-action: none;
  }
  #touchLeft {
    left: 0;
  }
  #touchRight {
    right: 0;
  }
</style>
</head>
<body>

<h1>PINPONG</h1>

<div id="scoreboard" aria-live="polite" aria-atomic="true" aria-label="Счет игры">
  <span id="score1">0</span> : <span id="score2">0</span>
</div>

<div id="modeSelect" role="radiogroup" aria-label="Выбор режима игры">
  <button id="btnSingle" role="radio" aria-checked="false" tabindex="0">1 Игрок</button>
  <button id="btnDouble" role="radio" aria-checked="false" tabindex="0">2 Игрока</button>
</div>

<div id="gameContainer" aria-label="Игровое поле">
  <canvas id="gameCanvas" width="800" height="450" aria-describedby="info"></canvas>
</div>

<div id="info" role="status" aria-live="polite"></div>

<!-- Для мобильного управления -->
<div id="touchLeft" aria-hidden="true"></div>
<div id="touchRight" aria-hidden="true"></div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // Размеры и пропорции
  let WIDTH = canvas.width;
  let HEIGHT = canvas.height;

  // Параметры ракеток
  const PADDLE_WIDTH = 12;
  const PADDLE_HEIGHT = 90;
  const PADDLE_SPEED = 6;

  // Мяч
  const BALL_RADIUS = 10;
  const BALL_SPEED_INIT = 5;

  // Время игры в мс
  const GAME_TIME = 2 * 60 * 1000;

  // Цвета и стиль (awesome motorcycle style)
  const COLOR_BG = '#121212';
  const COLOR_LINES = '#f0a500';
  const COLOR_PADDLE = '#f0a500';
  const COLOR_BALL = '#f0a500';

  // Игровые переменные
  let paddle1Y, paddle2Y;
  let ballX, ballY;
  let ballSpeedX, ballSpeedY;
  let score1, score2;
  let isRunning = false;
  let mode = null; // 'single' или 'double'
  let keysPressed = {};
  let gameStartTime = 0;
  let gameTimerId = null;
  let animationFrameId = null;

  // Для мобильного управления
  const touchLeft = document.getElementById('touchLeft');
  const touchRight = document.getElementById('touchRight');
  let touchPaddle1Y = null;
  let touchPaddle2Y = null;

  // Элементы UI
  const score1El = document.getElementById('score1');
  const score2El = document.getElementById('score2');
  const infoEl = document.getElementById('info');
  const btnSingle = document.getElementById('btnSingle');
  const btnDouble = document.getElementById('btnDouble');
  const modeSelect = document.getElementById('modeSelect');

  // Инициализация игры
  function initGame() {
    paddle1Y = HEIGHT / 2 - PADDLE_HEIGHT / 2;
    paddle2Y = HEIGHT / 2 - PADDLE_HEIGHT / 2;
    ballX = WIDTH / 2;
    ballY = HEIGHT / 2;

    // Случайное направление мяча по X
    ballSpeedX = BALL_SPEED_INIT * (Math.random() < 0.5 ? 1 : -1);
    // Случайная скорость по Y
    ballSpeedY = (Math.random() * 4 + 2) * (Math.random() < 0.5 ? 1 : -1);

    score1 = 0;
    score2 = 0;
    updateScore();

    infoEl.textContent = 'Игра началась! Время: 2 минуты';

    gameStartTime = performance.now();
    isRunning = true;

    // Запускаем таймер окончания игры
    if (gameTimerId) clearTimeout(gameTimerId);
    gameTimerId = setTimeout(() => {
      isRunning = false;
      endGame();
    }, GAME_TIME);

    // Запускаем анимацию
    if (animationFrameId) cancelAnimationFrame(animationFrameId);
    animationFrameId = requestAnimationFrame(gameLoop);
  }

  // Обновление счета на экране
  function updateScore() {
    score1El.textContent = score1;
    score2El.textContent = score2;
  }

  // Отрисовка игрового поля
  function drawField() {
    ctx.fillStyle = COLOR_BG;
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    // Центр линия пунктиром
    ctx.strokeStyle = COLOR_LINES;
    ctx.lineWidth = 3;
    ctx.setLineDash([15, 15]);
    ctx.beginPath();
    ctx.moveTo(WIDTH / 2, 0);
    ctx.lineTo(WIDTH / 2, HEIGHT);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // Отрисовка ракеток
  function drawPaddles() {
    ctx.fillStyle = COLOR_PADDLE;

    // Левая ракетка
    ctx.beginPath();
    ctx.moveTo(20, paddle1Y);
    ctx.lineTo(20 + PADDLE_WIDTH, paddle1Y);
    ctx.lineTo(20 + PADDLE_WIDTH, paddle1Y + PADDLE_HEIGHT);
    ctx.lineTo(20, paddle1Y + PADDLE_HEIGHT);
    ctx.closePath();
    ctx.fill();

    // Правая ракетка
    ctx.beginPath();
    ctx.moveTo(WIDTH - 20 - PADDLE_WIDTH, paddle2Y);
    ctx.lineTo(WIDTH - 20, paddle2Y);
    ctx.lineTo(WIDTH - 20, paddle2Y + PADDLE_HEIGHT);
    ctx.lineTo(WIDTH - 20 - PADDLE_WIDTH, paddle2Y + PADDLE_HEIGHT);
    ctx.closePath();
    ctx.fill();
  }

  // Отрисовка мяча
  function drawBall() {
    ctx.strokeStyle = COLOR_BALL;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(ballX, ballY, BALL_RADIUS, 0, Math.PI * 2);
    ctx.stroke();
  }

  // Обработка движения ракеток игроков
  function playerMove() {
    // Игрок 1 (W/S)
    if (keysPressed['KeyW']) {
      paddle1Y -= PADDLE_SPEED;
    }
    if (keysPressed['KeyS']) {
      paddle1Y += PADDLE_SPEED;
    }
    paddle1Y = Math.min(Math.max(paddle1Y, 0), HEIGHT - PADDLE_HEIGHT);

    if (mode === 'double') {
      // Игрок 2 (стрелки вверх/вниз)
      if (keysPressed['ArrowUp']) {
        paddle2Y -= PADDLE_SPEED;
      }
      if (keysPressed['ArrowDown']) {
        paddle2Y += PADDLE_SPEED;
      }
      paddle2Y = Math.min(Math.max(paddle2Y, 0), HEIGHT - PADDLE_HEIGHT);
    }
  }

  // Плавное движение бота
  function botMove() {
    const centerPaddle = paddle2Y + PADDLE_HEIGHT / 2;
    const diff = ballY - centerPaddle;
    const maxBotSpeed = PADDLE_SPEED * 1.2;
    const smoothFactor = 0.15;

    let move = diff * smoothFactor;
    if (move > maxBotSpeed) move = maxBotSpeed;
    if (move < -maxBotSpeed) move = -maxBotSpeed;

    paddle2Y += move;
    paddle2Y = Math.min(Math.max(paddle2Y, 0), HEIGHT - PADDLE_HEIGHT);
  }

  // Обработка столкновений мяча с ракетками и стенами
  function ballMove() {
    ballX += ballSpeedX;
    ballY += ballSpeedY;

    // Верхняя и нижняя стенка
    if (ballY - BALL_RADIUS < 0) {
      ballY = BALL_RADIUS;
      ballSpeedY = -ballSpeedY;
    }
    if (ballY + BALL_RADIUS > HEIGHT) {
      ballY = HEIGHT - BALL_RADIUS;
      ballSpeedY = -ballSpeedY;
    }

    // Левая ракетка
    if (
      ballX - BALL_RADIUS < 20 + PADDLE_WIDTH &&
      ballX - BALL_RADIUS > 20 &&
      ballY > paddle1Y &&
      ballY < paddle1Y + PADDLE_HEIGHT
    ) {
      ballX = 20 + PADDLE_WIDTH + BALL_RADIUS;
      ballSpeedX = -ballSpeedX;

      // Добавим немного вариации по Y в зависимости от места удара
      let deltaY = ballY - (paddle1Y + PADDLE_HEIGHT / 2);
      ballSpeedY = deltaY * 0.25;
    }

    // Правая ракетка
    if (
      ballX + BALL_RADIUS > WIDTH - 20 - PADDLE_WIDTH &&
      ballX + BALL_RADIUS < WIDTH - 20 &&
      ballY > paddle2Y &&
      ballY < paddle2Y + PADDLE_HEIGHT
    ) {
      ballX = WIDTH - 20 - PADDLE_WIDTH - BALL_RADIUS;
      ballSpeedX = -ballSpeedX;

      let deltaY = ballY - (paddle2Y + PADDLE_HEIGHT / 2);
      ballSpeedY = deltaY * 0.25;
    }

    // Голы
    if (ballX < 0) {
      score2++;
      updateScore();
      resetBall(-1);
    }
    if (ballX > WIDTH) {
      score1++;
      updateScore();
      resetBall(1);
    }  }

  // Сброс мяча после гола
  function resetBall(direction) {
    ballX = WIDTH / 2;
    ballY = HEIGHT / 2;
    ballSpeedX = BALL_SPEED_INIT * direction;
    ballSpeedY = (Math.random() * 4 + 2) * (Math.random() < 0.5 ? 1 : -1);
  }

  // Основной игровой цикл
  function gameLoop() {
    if (!isRunning) return;

    // Движение игроков
    playerMove();

    // Движение бота или второго игрока
    if (mode === 'single') {
      botMove();
    }

    // Движение мяча
    ballMove();

    // Отрисовка
    drawField();
    drawPaddles();
    drawBall();

    // Обновление таймера
    const elapsed = performance.now() - gameStartTime;
    const timeLeft = Math.max(0, GAME_TIME - elapsed);
    const secondsLeft = Math.floor(timeLeft / 1000);
    infoEl.textContent = `Осталось времени: ${secondsLeft} сек`;

    animationFrameId = requestAnimationFrame(gameLoop);
  }

  // Конец игры
  function endGame() {
    isRunning = false;
    animationFrameId && cancelAnimationFrame(animationFrameId);
    gameTimerId && clearTimeout(gameTimerId);

    let winnerText = '';
    if (score1 > score2) {
      winnerText = 'Победил Игрок 1!';
    } else if (score2 > score1) {
      winnerText = mode === 'single' ? 'Победил Бот!' : 'Победил Игрок 2!';
    } else {
      winnerText = 'Ничья!';
    }
    infoEl.textContent = `Игра окончена! ${winnerText} Нажмите кнопку, чтобы сыграть снова.`;

    // Показываем выбор режима снова
    modeSelect.style.display = 'flex';
  }

  // Обработчики выбора режима
  function selectMode(selectedMode) {
    mode = selectedMode;
    score1 = 0;
    score2 = 0;
    updateScore();
    modeSelect.style.display = 'none';
    infoEl.textContent = '';
    initGame();
  }

  btnSingle.addEventListener('click', () => {
    selectMode('single');
    btnSingle.setAttribute('aria-checked', 'true');
    btnDouble.setAttribute('aria-checked', 'false');
  });
  btnDouble.addEventListener('click', () => {
    selectMode('double');
    btnSingle.setAttribute('aria-checked', 'false');
    btnDouble.setAttribute('aria-checked', 'true');
  });

  // Клавиатура
  window.addEventListener('keydown', e => {
    keysPressed[e.code] = true;
  });
  window.addEventListener('keyup', e => {
    keysPressed[e.code] = false;
  });

  // Адаптивное масштабирование canvas
  function resizeCanvas() {
    const container = document.getElementById('gameContainer');
    const rect = contai.getBoundingClientRect();

    // Поддерживаем соотношение 16:9
    let w = rect.width;
    let h = rect.height;

    // Устанавливаем размеры canvas в пикселях (для рендеринга)
    canvas.width = 800;
    canvas.height = 450;

    // Устанавливаем CSS размеры canvas для масштабирования
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';

    WIDTH = canvas.width;
    HEIGHT = canvas.height;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Мобильное управление касаниями
  // Левая зона — управление левой ракеткой
  touchLeft.addEventListener('touchstart', e => {
    e.preventDefault();
    if (!isRunning) return;
    const touch = e.touches[0];
    touchPaddle1Y = touch.clientY;
  }, {passive: false});
  touchLeft.addEventListener('touchmove', e => {
    e.preventDefault();
    if (!isRunning) return;
    const touch = e.touches[0];
    const deltaY = touch.clientY - touchPaddle1Y;
    paddle1Y += deltaY;
    paddle1Y = Math.min(Math.max(paddle1Y, 0), HEIGHT - PADDLE_HEIGHT);
    touchPaddle1Y = touch.clientY;
  }, {passive: false});
  touchLeft.addEventListener('touchend', e => {
    e.preventDefault();
    touchPaddle1Y = null;
  }, {passive: false});

  // Правая зона — управление правой ракеткой (если 2 игрока)
  touchRight.addEventListener('touchstart', e => {
    e.preventDefault();
    if (!isRunning || mode !== 'double') return;
    const touch = e.touches[0];
    touchPaddle2Y = touch.clientY;
  }, {passive: false});
  touchRight.addEventListener('touchmove', e => {
    e.preventDefault();
    if (!isRunning || mode !== 'double') return;
    const touch = e.touches[0];
    const deltaY = touch.clientY - touchPaddle2Y;
    paddle2Y += deltaY;
    paddle2Y = Math.min(Math.max(paddle2Y, 0), HEIGHT - PADDLE_HEIGHT);
    touchPaddle2Y = touch.clientY;
  }, {passive: false});
  touchRight.addEventListener('touchend', e => {
    e.preventDefault();
    touchPaddle2Y = null;
  }, {passive: false});

  // Инициализация UI
  function initUI() {
    modeSelect.style.display = 'flex';
    btnSingle.setAttribute('aria-checked', 'false');
    btnDouble.setAttribute('aria-checked', 'false');
    infoEl.textContent = 'Выберите режим игры';
  }
  initUI();

})();
</script>

</body>
</html>
