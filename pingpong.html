<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–∏–Ω–ø–æ–Ω–≥ ‚Äî –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      background: #121212;
      color: #eee;
      font-family: 'Roboto Mono', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      user-select: none;
      overflow: hidden;
    }
    h1 {
      margin-bottom: 10px;
      font-weight: 700;
      font-size: 2.5rem;
      text-shadow: 0 0 8px #00bfff88;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ */
    #mode-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      display: flex;
      gap: 12px;
      z-index: 10;
    }
    .mode-btn {
      background: #222;
      border: 2px solid #00bfff;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 1.4rem;
      cursor: pointer;
      color: #00bfff;
      box-shadow: 0 0 8px #00bfff88;
      display: flex;
      align-items: center;
      gap: 8px;
      transition:
        background 0.3s ease,
        color 0.3s ease,
        box-shadow 0.3s ease,
        border-color 0.3s ease;
      user-select: none;
    }
    .mode-btn:hover {
      background: #00bfff22;
      box-shadow: 0 0 14px #00d4ffcc;
    }
    .mode-btn.active {
      background: #00bfff;
      color: #121212;
      border-color: #00a3cc;
      box-shadow: 0 0 20px #00bfffee;
    }
    .mode-btn span.emoji {
      font-size: 1.8rem;
      line-height: 1;
    }
    canvas {
      background: linear-gradient(135deg, #222, #111);
      border-radius: 12px;
      box-shadow:
        0 0 20px #00bfff88,
        inset 0 0 15px #00bfff44;
      image-rendering: auto;
      display: block;
      margin-top: 80px;
    }
    .scoreboard {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      display: flex;
      justify-content: center;
      gap: 80px;
      width: 100%;
      max-width: 640px;
      margin: 20px 0 40px;
      color: #00bfff;
      text-shadow: 0 0 8px #00bfffaa;
      user-select: none;
    }
    .scoreboard span {
      min-width: 50px;
      text-align: center;
    }
    .instructions {
      font-size: 0.9rem;
      color: #aaa;
      max-width: 640px;
      text-align: center;
      line-height: 1.4;
      margin-bottom: 40px;
      user-select: none;
    }
    a.back-link {
      color: #00bfff;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: color 0.3s ease;
      user-select: none;
    }
    a.back-link:hover {
      color: #0099cc;
    }
  </style>
</head>
<body>
  <h1>–ü–∏–Ω–ø–æ–Ω–≥</h1>

  <div id="mode-buttons" aria-label="–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã">
    <button class="mode-btn active" data-mode="bot" aria-pressed="true" title="–ò–≥—Ä–∞ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞">
      <span class="emoji" aria-hidden="true">ü§ñ</span> –ë–æ—Ç
    </button>
    <button class="mode-btn" data-mode="2p" aria-pressed="false" title="–ò–≥—Ä–∞ –¥–ª—è –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤">
      <span class="emoji" aria-hidden="true">üë•</span> 2 –ò–≥—Ä–æ–∫–∞
    </button>
  </div>

  <canvas id="game" width="640" height="400" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –ü–∏–Ω–ø–æ–Ω–≥" role="img"></canvas>

  <div class="scoreboard" aria-live="polite" aria-atomic="true">
    <span id="left-score">0</span> : <span id="right-score">0</span>
  </div>

  <div class="instructions">
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:<br />
    –õ–µ–≤–∞—è —Ä–∞–∫–µ—Ç–∫–∞: <strong>W</strong> (–≤–≤–µ—Ä—Ö), <strong>S</strong> (–≤–Ω–∏–∑) ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ 2 –∏–≥—Ä–æ–∫–æ–≤<br />
    –ü—Ä–∞–≤–∞—è —Ä–∞–∫–µ—Ç–∫–∞: <strong>‚Üë</strong> (–≤–≤–µ—Ä—Ö), <strong>‚Üì</strong> (–≤–Ω–∏–∑)
  </div>

  <a href="index.html" class="back-link">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>

  <script>
    (() => {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const leftScoreEl = document.getElementById('left-score');
      const rightScoreEl = document.getElementById('right-score');
      const modeButtons = document.querySelectorAll('.mode-btn');

      const WIDTH = canvas.width;
      const HEIGHT = canvas.height;

      const PADDLE_WIDTH = 12;
      const PADDLE_HEIGHT = 90;
      const PADDLE_SPEED = 7;

      const BALL_SIZE = 14;
      const BALL_SPEED = 6;

      let mode = 'bot'; // 'bot' –∏–ª–∏ '2p'
      let gameStarted = false;

      // –ò–≥—Ä–æ–∫–∏
      const leftPaddle = {
        x: 20,
        y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
        dy: 0,
        flashFrames: 0,
      };

      const rightPaddle = {
        x: WIDTH - PADDLE_WIDTH - 20,
        y: HEIGHT / 2 - PADDLE_HEIGHT / 2,
        dy: 0,
        flashFrames: 0,
      };

      const ball = {
        x: WIDTH / 2 - BALL_SIZE / 2,
        y: HEIGHT / 2 - BALL_SIZE / 2,
        dx: BALL_SPEED,
        dy: BALL_SPEED,
      };

      let leftScore = 0;
      let rightScore = 0;

      const keys = {};

      // –≠—Ñ—Ñ–µ–∫—Ç—ã –≤—Å–ø—ã—à–∫–∏ –¥–ª—è –∫—Ä–∞—ë–≤
      const edgeFlash = {
        top: 0,
        bottom: 0,
        maxFrames: 6,
      };

      function resetBall() {
        ball.x = WIDTH / 2 - BALL_SIZE / 2;
        ball.y = HEIGHT / 2 - BALL_SIZE / 2;
        ball.dx = BALL_SPEED * (Math.random() < 0.5 ? 1 : -1);
        ball.dy = BALL_SPEED * (Math.random() * 2 - 1);
      }

      function drawRect(x, y, w, h, color, flashFrames = 0) {
        if (flashFrames > 0) {
          const alpha = flashFrames / 6;
          ctx.fillStyle = `rgba(0,191,255,${alpha})`;
          ctx.shadowColor = `rgba(0,191,255,${alpha})`;
          ctx.shadowBlur = 15 * alpha;
        } else {
          ctx.fillStyle = color;
          ctx.shadowColor = 'rgba(0,191,255,0.7)';
          ctx.shadowBlur = 8;
        }
        ctx.fillRect(x, y, w, h);
        ctx.shadowBlur = 0;
      }

      function drawCircle(x, y, r, color) {
        ctx.fillStyle = color;
        ctx.shadowColor = 'rgba(0,191,255,0.7)';
        ctx.shadowBlur = 12;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      function drawNet() {
        const netWidth = 4;
        const netHeight = 20;
        ctx.fillStyle = '#00bfff';
        ctx.shadowColor = 'rgba(0,191,255,0.5)';
        ctx.shadowBlur = 6;
        for (let i = 0; i < HEIGHT; i += netHeight * 2) {
          ctx.fillRect(WIDTH / 2 - netWidth / 2, i, netWidth, netHeight);
        }
        ctx.shadowBlur = 0;
      }

      function drawText(text, x, y, size = 32, color = '#00bfff') {
        ctx.fillStyle = color;
        ctx.shadowColor = 'rgba(0,191,255,0.8)';
        ctx.shadowBlur = 10;
        ctx.font = `bold ${size}px 'Roboto Mono', monospace`;
        ctx.textAlign = 'center';
        ctx.fillText(text, x, y);
        ctx.shadowBlur = 0;
      }

      function update() {
        // –î–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç–æ–∫
        if (mode === '2p') {
          if (keys['w']) leftPaddle.y -= PADDLE_SPEED;
          if (keys['s']) leftPaddle.y += PADDLE_SPEED;
        } else {
          // –ò–≥—Ä–∞ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞ ‚Äî –ª–µ–≤—ã–π –±–æ—Ç
          const targetY = ball.y + BALL_SIZE / 2 - PADDLE_HEIGHT / 2;
          if (leftPaddle.y + PADDLE_HEIGHT / 2 < targetY - 10) {
            leftPaddle.y += PADDLE_SPEED * 0.6;
          } else if (leftPaddle.y + PADDLE_HEIGHT / 2 > targetY + 10) {
            leftPaddle.y -= PADDLE_SPEED * 0.6;
          }
        }

        if (keys['arrowup']) rightPaddle.y -= PADDLE_SPEED;
        if (keys['arrowdown']) rightPaddle.y += PADDLE_SPEED;

        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —ç–∫—Ä–∞–Ω—É
        leftPaddle.y = Math.max(0, Math.min(HEIGHT - PADDLE_HEIGHT, leftPaddle.y));
        rightPaddle.y = Math.max(0, Math.min(HEIGHT - PADDLE_HEIGHT, rightPaddle.y));

        // –î–≤–∏–∂–µ–Ω–∏–µ –º—è—á–∞
        ball.x += ball.dx;
        ball.y += ball.dy;

        // –û—Ç—Å–∫–æ–∫ –æ—Ç –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º
        if (ball.y <= 0) {
          ball.y = 0;
          ball.dy = -ball.dy;
          edgeFlash.top = edgeFlash.maxFrames;
        }
        if (ball.y + BALL_SIZE >= HEIGHT) {
          ball.y = HEIGHT - BALL_SIZE;
          ball.dy = -ball.dy;
          edgeFlash.bottom = edgeFlash.maxFrames;
        }

        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Ä–∞–∫–µ—Ç–∫–∞–º–∏ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º
        if (
          ball.x <= leftPaddle.x + PADDLE_WIDTH &&
          ball.x >= leftPaddle.x &&
          ball.y + BALL_SIZE >= leftPaddle.y &&
          ball.y <= leftPaddle.y + PADDLE_HEIGHT
        ) {
          ball.x = leftPaddle.x + PADDLE_WIDTH;
          ball.dx = -ball.dx;
          let collidePoint = (ball.y + BALL_SIZE / 2) - (leftPaddle.y + PADDLE_HEIGHT / 2);
          ball.dy = collidePoint * 0.3;
          leftPaddle.flashFrames = 6;
        }

        if (
          ball.x + BALL_SIZE >= rightPaddle.x &&
          ball.x + BALL_SIZE <= rightPaddle.x + PADDLE_WIDTH &&
          ball.y + BALL_SIZE >= rightPaddle.y &&
          ball.y <= rightPaddle.y + PADDLE_HEIGHT
        ) {
          ball.x = rightPaddle.x - BALL_SIZE;
          ball.dx = -ball.dx;
          let collidePoint = (ball.y + BALL_SIZE / 2) - (rightPaddle.y + PADDLE_HEIGHT / 2);
          ball.dy = collidePoint * 0.3;
          rightPaddle.flashFrames = 6;
        }

        // –ì–æ–ª—ã
        if (ball.x < 0) {
          rightScore++;
          updateScore();
          resetBall();
        }
        if (ball.x > WIDTH) {
          leftScore++;
          updateScore();
          resetBall();
        }

        // –£–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        if (leftPaddle.flashFrames > 0) leftPaddle.flashFrames--;
        if (rightPaddle.flashFrames > 0) rightPaddle.flashFrames--;
        if (edgeFlash.top > 0) edgeFlash.top--;
        if (edgeFlash.bottom > 0) edgeFlash.bottom--;
      }

      function updateScore() {
        leftScoreEl.textContent = leftScore;
        rightScoreEl.textContent = rightScore;
      }

      function draw() {
        ctx.clearRect(0, 0, WIDTH, HEIGHT);

        drawNet();

        // –ö—Ä–∞—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –≤—Å–ø—ã—à–∫–∏
        if (edgeFlash.top > 0) {
          const alpha = edgeFlash.top / edgeFlash.maxFrames;
          ctx.fillStyle = `rgba(255,255,255,${alpha})`;
          ctx.fillRect(0, 0, WIDTH, 5);
        }
        if (edgeFlash.bottom > 0) {
          const alpha = edgeFlash.bottom / edgeFlash.maxFrames;
          ctx.fillStyle = `rgba(255,255,255,${alpha})`;
          ctx.fillRect(0, HEIGHT - 5, WIDTH, 5);
        }

        // –†–∞–∫–µ—Ç–∫–∏ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –≤—Å–ø—ã—à–∫–∏
        drawRect(leftPaddle.x, leftPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT, '#00bfff', leftPaddle.flashFrames);
        drawRect(rightPaddle.x, rightPaddle.y, PADDLE_WIDTH, PADDLE_HEIGHT, '#00bfff', rightPaddle.flashFrames);

        drawCircle(ball.x + BALL_SIZE / 2, ball.y + BALL_SIZE / 2, BALL_SIZE / 2, '#00bfff');

        drawText(leftScore, WIDTH / 4, 50);
        drawText(rightScore, WIDTH * 3 / 4, 50);
      }

      function gameLoop() {
        if (!gameStarted) return;
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏—à
      window.addEventListener('keydown', e => {
        keys[e.key.toLowerCase()] = true;
      });
      window.addEventListener('keyup', e => {
        keys[e.key.toLowerCase()] = false;
      });

      // –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –ø–æ –∫–Ω–æ–ø–∫–∞–º ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
      modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.classList.contains('active')) return; // –µ—Å–ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
          modeButtons.forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
          mode = btn.dataset.mode;
          startGame();
        });
      });

      function startGame() {
        leftScore = 0;
        rightScore = 0;
        updateScore();

        leftPaddle.y = HEIGHT / 2 - PADDLE_HEIGHT / 2;
        rightPaddle.y = HEIGHT / 2 - PADDLE_HEIGHT / 2;
        leftPaddle.flashFrames = 0;
        rightPaddle.flashFrames = 0;
        edgeFlash.top = 0;
        edgeFlash.bottom = 0;

        resetBall();

        gameStarted = true;
        gameLoop();
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É —Å —Ä–µ–∂–∏–º–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      startGame();
    })();
  </script>
</body>
</html>
