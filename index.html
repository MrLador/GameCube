<!DOCTYPE html>
<html>
<head>
    <title>Dust Racing 2D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c3e50; }
        canvas { background: #27ae60; }
        #hud {
            position: fixed; top: 10px; left: 10px;
            color: white; font-family: Arial; font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="hud">Laps: <span id="laps">0</span>/2</div>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

const TRACK = [
    {x: 200, y: 900, w: 400}, {x: 200, y: 700, w: 400}, 
    {x: 400, y: 500, w: 400, r: 45}, {x: 600, y: 300, w: 400, r: 90},
    {x: 600, y: 100, w: 400}, {x: 400, y: -100, w: 400, r: -45}
];

class Car {
    constructor(color) {
        this.x = 400;
        this.y = 900;
        this.speed = 0;
        this.angle = 0;
        this.color = color;
        this.laps = 0;
        this.checkpoint = 0;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle * Math.PI / 180);
        
        // Кузов
        ctx.fillStyle = this.color;
        ctx.fillRect(-20, -10, 40, 20);
        
        // Кабина
        ctx.fillStyle = '#fff';
        ctx.fillRect(-15, -8, 30, 10);
        
        // Колёса
        ctx.fillStyle = '#2c3e50';
        ctx.fillRect(-25, -15, 10, 10);
        ctx.fillRect(15, -15, 10, 10);
        ctx.fillRect(-25, 5, 10, 10);
        ctx.fillRect(15, 5, 10, 10);
        
        ctx.restore();
    }

    update() {
        this.x += Math.cos(this.angle * Math.PI / 180) * this.speed;
        this.y += Math.sin(this.angle * Math.PI / 180) * this.speed;
        this.speed *= 0.96;
    }
}

const player = new Car('#e74c3c');
const bots = Array.from({length: 5}, (_, i) => 
    new Car(['#3498db', '#9b59b6', '#2ecc71', '#f1c40f', '#95a5a6'][i]));

function init() {
    bots.forEach((bot, i) => {
        bot.x = 300 + i * 80;
        bot.y = 800 - i * 100;
        bot.speed = 3 + Math.random() * 2;
    });
}

function drawTrack() {
    TRACK.forEach(segment => {
        ctx.fillStyle = '#7f8c8d';
        ctx.fillRect(segment.x - segment.w/2, segment.y, segment.w, 200);
    });
}

function aiMove(bot) {
    const target = TRACK[bot.checkpoint % TRACK.length];
    const dx = target.x - bot.x;
    const dy = target.y - bot.y;
    bot.angle = Math.atan2(dy, dx) * 180 / Math.PI;
    
    if(Math.hypot(dx, dy) < 50) bot.checkpoint++;
    bot.speed = 3 + (Math.random() - 0.5);
}

function checkCollision(a, b) {
    return Math.hypot(a.x - b.x, a.y - b.y) < 30;
}

function gameLoop() {
    ctx.clearRect(0, 0, width, height);
    
    // Отрисовка трека
    drawTrack();
    
    // Обновление ботов
    bots.forEach(bot => {
        aiMove(bot);
        bot.update();
        bot.draw();
    });
    
    // Обновление игрока
    player.update();
    player.draw();
    
    // Проверка кругов
    if(player.y < 100 && player.checkpoint === TRACK.length) {
        player.laps++;
        document.getElementById('laps').textContent = player.laps;
        player.checkpoint = 0;
        if(player.laps >= 2) alert('Победа!');
    }
    
    // Проверка чекпоинтов
    TRACK.forEach((seg, i) => {
        if(Math.hypot(player.x - seg.x, player.y - seg.y) < 50) {
            player.checkpoint = Math.max(player.checkpoint, i);
        }
    });
    
    // Коллизии
    bots.forEach(bot => {
        if(checkCollision(player, bot)) {
            player.speed *= 0.5;
            bot.speed *= 0.5;
        }
    });
    
    requestAnimationFrame(gameLoop);
}

document.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') player.angle -= 5;
    if(e.key === 'ArrowRight') player.angle += 5;
    player.speed = Math.min(8, player.speed + 0.2);
});

init();
gameLoop();
</script>
</body>
</html>
