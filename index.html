<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Vector Pong в стиле Monument Valley</title>
<style>
  /* Сброс и базовые стили */
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: linear-gradient(135deg, #a8edea, #fed6e3);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    overflow: hidden;
  }
  #gameContainer {
    position: relative;
    background: #f0f4f8;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    border-radius: 20px;
  }
  canvas {
    display: block;
    background: #e0e7ff;
    border-radius: 20px;
  }
  #score {
    font-size: 2rem;
    font-weight: 700;
    color: #4a4a4a;
    margin: 10px 0;
    user-select: none;
  }
  #instructions {
    font-size: 1rem;
    color: #666;
    margin-top: 10px;
    user-select: none;
  }

  /* Вертикальный режим для мобильных */
  @media (max-width: 600px) {
    body {
      flex-direction: column;
    }
    #gameContainer {
      width: 90vw;
      height: 120vw; /* вертикальный прямоугольник */
    }
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
    #instructions {
      display: none; /* скрываем инструкции на мобилках */
    }
  }

  /* Горизонтальный режим для десктопа */
  @media (min-width: 601px) {
    #gameContainer {
      width: 800px;
      height: 450px;
    }
    canvas {
      width: 800px !important;
      height: 450px !important;
    }
  }
</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas" width="800" height="450"></canvas>
  <div id="score">0 : 0</div>
  <div id="instructions">Управление: W/S и стрелки вверх/вниз</div>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // Размеры игрового поля (будут масштабироваться)
  let width = canvas.width;
  let height = canvas.height;

  // Ракетки
  const paddleWidth = 15;
  const paddleHeight = 100;
  const paddleSpeed = 6;

  // Мяч
  const ballRadius = 12;

  // Цвета для мяча (пастельные)
  const ballColors = [
    '#a8edea', '#fed6e3', '#fcb69f', '#a1c4fd', '#c2e9fb', '#d4fc79', '#96e6a1'
  ];

  // Игроки
  const leftPaddle = {
    x: 10,
    y: height / 2 - paddleHeight / 2,
    dy: 0
  };
  const rightPaddle = {
    x: width - paddleWidth - 10,
    y: height / 2 - paddleHeight / 2,
    dy: 0
  };

  // Мяч
  const ball = {
    x: width / 2,
    y: height / 2,
    dx: 5,
    dy: 3,
    radius: ballRadius,
    color: ballColors[0]
  };

  // Счёт
  let scoreLeft = 0;
  let scoreRight = 0;

  // Управление
  const keys = {};

  // Обновление размеров и масштабирование для мобильных
  function resize() {
    const container = document.getElementById('gameContainer');
    const rect = container.getBoundingClientRect();

    canvas.width = rect.width;
    canvas.height = rect.height;

    width = canvas.width;
    height = canvas.height;

    // Обновляем позиции ракеток и мяча пропорционально
    leftPaddle.y = Math.min(leftPaddle.y, height - paddleHeight);
    rightPaddle.y = Math.min(rightPaddle.y, height - paddleHeight);

    // Если мяч вышел за пределы, сбросим в центр
    ball.x = width / 2;
    ball.y = height / 2;
  }

  window.addEventListener('resize', resize);
  resize();

  // Функция смены цвета мяча на случайный из палитры, отличный от текущего
  function changeBallColor() {
    let newColor;
    do {
      newColor = ballColors[Math.floor(Math.random() * ballColors.length)];
    } while (newColor === ball.color);
    ball.color = newColor;
  }

  // Обработка нажатий клавиш
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  // Обновление позиции ракеток
  function updatePaddles() {
    // Левая ракетка: W/S
    if (keys['w']) {
      leftPaddle.y -= paddleSpeed;
    } else if (keys['s']) {
      leftPaddle.y += paddleSpeed;
    }
    // Правая ракетка: стрелки вверх/вниз
    if (keys['arrowup']) {
      rightPaddle.y -= paddleSpeed;
    } else if (keys['arrowdown']) {
      rightPaddle.y += paddleSpeed;
    }

    // Ограничение по краям
    leftPaddle.y = Math.max(0, Math.min(height - paddleHeight, leftPaddle.y));
    rightPaddle.y = Math.max(0, Math.min(height - paddleHeight, rightPaddle.y));
  }

  // Проверка столкновений мяча с ракетками
  function checkPaddleCollision() {
    // Левая ракетка
    if (
      ball.x - ball.radius <= leftPaddle.x + paddleWidth &&
      ball.x - ball.radius >= leftPaddle.x &&
      ball.y >= leftPaddle.y &&
      ball.y <= leftPaddle.y + paddleHeight
    ) {
      ball.dx = -ball.dx;
      ball.x = leftPaddle.x + paddleWidth + ball.radius; // чтобы не застрял
      changeBallColor();
    }

    // Правая ракетка
    if (
      ball.x + ball.radius >= rightPaddle.x &&
      ball.x + ball.radius <= rightPaddle.x + paddleWidth &&
      ball.y >= rightPaddle.y &&
      ball.y <= rightPaddle.y + paddleHeight
    ) {
      ball.dx = -ball.dx;
      ball.x = rightPaddle.x - ball.radius;
      changeBallColor();
    }
  }

  // Обновление позиции мяча и проверка столкновений со стенами
  function updateBall() {
    ball.x += ball.dx;
    ball.y += ball.dy;

    // Верхняя и нижняя стенки
    if (ball.y - ball.radius <= 0) {
      ball.dy = -ball.dy;
      ball.y = ball.radius;
      changeBallColor();
    }
    if (ball.y + ball.radius >= height) {
      ball.dy = -ball.dy;
      ball.y = height - ball.radius;
      changeBallColor();
    }

    // Левая и правая стенки — очки
    if (ball.x - ball.radius <= 0) {
      scoreRight++;
      resetBall();
    }
    if (ball.x + ball.radius >= width) {
      scoreLeft++;
      resetBall();
    }
  }

  // Сброс мяча в центр с рандомным направлением
  function resetBall() {
    ball.x = width / 2;
    ball.y = height / 2;
    ball.dx = (Math.random() > 0.5 ? 1 : -1) * (4 + Math.random() * 2);
    ball.dy = (Math.random() > 0.5 ? 1 : -1) * (3 + Math.random() * 2);
    ball.color = ballColors[0];
  }

  // Отрисовка ракеток
  function drawPaddle(paddle) {
    ctx.fillStyle = '#6c63ff'; // стиль в духе Monument Valley — насыщенный фиолетовый
    ctx.lineJoin = 'round';
    ctx.lineWidth = 4;
    ctx.strokeStyle = '#4b47a1';
    ctx.beginPath();
    ctx.moveTo(paddle.x, paddle.y);
    ctx.lineTo(paddle.x + paddleWidth, paddle.y);
    ctx.lineTo(paddle.x + paddleWidth, paddle.y + paddleHeight);
    ctx.lineTo(paddle.x, paddle.y + paddleHeight);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
  }

  // Отрисовка мяча
  function drawBall() {
    ctx.fillStyle = ball.color;
    ctx.strokeStyle = '#4b47a1';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
  }

  // Отрисовка счета
  function drawScore() {
    const scoreDiv = document.getElementById('score');
    scoreDiv.textContent = `${scoreLeft} : ${scoreRight}`;
  }

  // Основной цикл игры
  function gameLoop() {
    ctx.clearRect(0, 0, width, height);

    updatePaddles();
    updateBall();
    checkPaddleCollision();

    drawPaddle(leftPaddle);
    drawPaddle(rightPaddle);
    drawBall();
    drawScore();

    requestAnimationFrame(gameLoop);
  }

  // Запуск игры
  resetBall();
  gameLoop();
})();
</script>

</body>
</html>
