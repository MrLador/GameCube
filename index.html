<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Ping Pong —Å –≤—ã–±–æ—Ä–æ–º —Ä–µ–∂–∏–º–∞ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #f0f0f0;
    font-family: Arial, sans-serif;
    user-select: none;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #score {
    font-size: 32px;
    font-weight: bold;
    color: #222;
    margin: 10px 0 5px 0;
    user-select: none;

    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    width: 120px;
  }
  #score1 {
    flex: 1;
    text-align: right;
  }
  #colon {
    flex: 0;
    width: 20px;
    text-align: center;
  }
  #score2 {
    flex: 1;
    text-align: left;
  }
  #gameContainer {
    position: relative;
    width: 95vw;
    max-width: 800px;
    aspect-ratio: 7 / 4;
    transition: all 0.3s ease;
    background: #222;
    border-radius: 8px;
    touch-action: none;
  }
  #gameCanvas {
    display: block;
    width: 100%;
    height: 100%;
    background: transparent;
  }
  #menu {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 10;
  }
  #menu h1 {
    color: #fff;
    margin-bottom: 20px;
  }
  #menu button {
    font-size: 40px;
    padding: 12px 24px;
    margin: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #0077cc;
    color: white;
    transition: background-color 0.3s ease;
    width: 120px;
    height: 80px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #menu button:hover {
    background: #005fa3;
  }
  #menu button span.emoji {
    font-size: 48px;
    user-select: none;
  }

  /* –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
  #touchControls {
    position: fixed;
    top: 0; bottom: 0;
    width: 100%;
    pointer-events: none;
    display: none;
    z-index: 20;
  }
  #leftControls, #rightControls {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 20px;
    pointer-events: auto;
  }
  #leftControls {
    left: 10px;
  }
  #rightControls {
    right: 10px;
  }
  .touchBtn {
    width: 60px;
    height: 60px;
    background: rgba(0, 119, 204, 0.7);
    border-radius: 50%;
    color: white;
    font-size: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    touch-action: none;
    box-shadow: 0 0 10px rgba(0,119,204,0.8);
    transition: background-color 0.2s ease;
  }
  .touchBtn:active {
    background: rgba(0, 119, 204, 1);
  }

  /* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: –ø–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤ */
  @media (max-width: 600px) {
    #gameContainer {
      width: 90vw;
      max-width: 400px;
      aspect-ratio: 4 / 7; /* –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ */
      /* –ü–æ–≤–æ—Ä–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
      transform: rotate(90deg);
      transform-origin: center center;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    #score {
      width: 140px;
      font-size: 28px;
      margin-bottom: 5px;
    }
    #touchControls {
      display: block;
    }
    /* –ü–æ–¥–≤–∏–Ω–µ–º –º–µ–Ω—é —á—É—Ç—å –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø–æ–≤–æ—Ä–æ—Ç */
    #menu h1 {
      font-size: 24px;
    }
  }
</style>
</head>
<body>

<div id="score">
  <span id="score1">0</span>
  <span id="colon">:</span>
  <span id="score2">0</span>
</div>

<div id="gameContainer">
  <canvas id="gameCanvas" width="700" height="400"></canvas>
</div>

<!-- –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div id="touchControls">
  <div id="leftControls">
    <div id="btnP1Up" class="touchBtn" aria-label="–ò–≥—Ä–æ–∫ 1 –≤–≤–µ—Ä—Ö">‚ñ≤</div>
    <div id="btnP1Down" class="touchBtn" aria-label="–ò–≥—Ä–æ–∫ 1 –≤–Ω–∏–∑">‚ñº</div>
  </div>
  <div id="rightControls">
    <div id="btnP2Up" class="touchBtn" aria-label="–ò–≥—Ä–æ–∫ 2 –≤–≤–µ—Ä—Ö">‚ñ≤</div>
    <div id="btnP2Down" class="touchBtn" aria-label="–ò–≥—Ä–æ–∫ 2 –≤–Ω–∏–∑">‚ñº</div>
  </div>
</div>

<div id="menu">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–≥—Ä—ã</h1>
  <button id="btnPvP"><span class="emoji">üë§vsüë§</span></button>
  <button id="btnPvBot"><span class="emoji">üë§vsü§ñ</span></button>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const score1Span = document.getElementById('score1');
  const score2Span = document.getElementById('score2');
  const menu = document.getElementById('menu');
  const btnPvP = document.getElementById('btnPvP');
  const btnPvBot = document.getElementById('btnPvBot');

  // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
  const touchControls = document.getElementById('touchControls');
  const btnP1Up = document.getElementById('btnP1Up');
  const btnP1Down = document.getElementById('btnP1Down');
  const btnP2Up = document.getElementById('btnP2Up');
  const btnP2Down = document.getElementById('btnP2Down');

  // –ë–∞–∑–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –ª–æ–≥–∏–∫–∏
  const BASE_WIDTH = 700;
  const BASE_HEIGHT = 400;

  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∫–µ—Ç–æ–∫
  const PADDLE_WIDTH = 10;
  const PADDLE_HEIGHT = 80;
  const PADDLE_SPEED = 6;

  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º—è—á–∞
  const BALL_RADIUS = 8;
  const BALL_SPEED = 5;

  // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
  let paddle1, paddle2, ball;
  let score1 = 0;
  let score2 = 0;

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  const keys = {};
  const touchState = {
    p1Up: false,
    p1Down: false,
    p2Up: false,
    p2Down: false
  };

  // –†–µ–∂–∏–º –∏–≥—Ä—ã: 'pvp' –∏–ª–∏ 'pvbot'
  let gameMode = null;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
  function initObjects() {
    paddle1 = {
      x: 10,
      y: BASE_HEIGHT / 2 - PADDLE_HEIGHT / 2,
      width: PADDLE_WIDTH,
      height: PADDLE_HEIGHT,
      dy: 0
    };

    paddle2 = {
      x: BASE_WIDTH - 10 - PADDLE_WIDTH,
      y: BASE_HEIGHT / 2 - PADDLE_HEIGHT / 2,
      width: PADDLE_WIDTH,
      height: PADDLE_HEIGHT,
      dy: 0
    };

    ball = {
      x: BASE_WIDTH / 2,
      y: BASE_HEIGHT / 2,
      radius: BALL_RADIUS,
      speedX: BALL_SPEED * (Math.random() < 0.5 ? 1 : -1),
      speedY: BALL_SPEED * (Math.random() * 2 - 1)
    };

    score1 = 0;
    score2 = 0;
    updateScore();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º div
  function updateScore() {
    score1Span.textContent = score1;
    score2Span.textContent = score2;
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–≥—Ä—ã
  function update() {
    // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ 1 ---
    // –ù–∞ –ü–ö ‚Äî –∫–ª–∞–≤–∏—à–∏ W/S (—á–µ—Ä–µ–∑ e.code)
    // –ù–∞ –º–æ–±–∏–ª–∫–µ ‚Äî —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    if (isMobile()) {
      if (touchState.p1Up) {
        paddle1.dy = -PADDLE_SPEED;
      } else if (touchState.p1Down) {
        paddle1.dy = PADDLE_SPEED;
      } else {
        paddle1.dy = 0;
      }
    } else {
      if (keys['KeyW']) {
        paddle1.dy = -PADDLE_SPEED;
      } else if (keys['KeyS']) {
        paddle1.dy = PADDLE_SPEED;
      } else {
        paddle1.dy = 0;
      }
    }
    paddle1.y += paddle1.dy;
    paddle1.y = Math.max(0, Math.min(BASE_HEIGHT - paddle1.height, paddle1.y));

    // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ 2 ---
    if (gameMode === 'pvp') {
      if (isMobile()) {
        if (touchState.p2Up) {
          paddle2.dy = -PADDLE_SPEED;
        } else if (touchState.p2Down) {
          paddle2.dy = PADDLE_SPEED;
        } else {
          paddle2.dy = 0;
        }
      } else {
        if (keys['ArrowUp']) {
          paddle2.dy = -PADDLE_SPEED;
        } else if (keys['ArrowDown']) {
          paddle2.dy = PADDLE_SPEED;
        } else {
          paddle2.dy = 0;
        }
      }
      paddle2.y += paddle2.dy;
      paddle2.y = Math.max(0, Math.min(BASE_HEIGHT - paddle2.height, paddle2.y));
    } else if (gameMode === 'pvbot') {
      // –ò–ò
      const centerPaddle = paddle2.y + paddle2.height / 2;
      if (centerPaddle < ball.y - 10) {
        paddle2.y += PADDLE_SPEED * 0.6;
      } else if (centerPaddle > ball.y + 10) {
        paddle2.y -= PADDLE_SPEED * 0.6;
      }
      paddle2.y = Math.max(0, Math.min(BASE_HEIGHT - paddle2.height, paddle2.y));
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –º—è—á–∞
    ball.x += ball.speedX;
    ball.y += ball.speedY;

    // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º
    if (ball.y - ball.radius < 0) {
      ball.y = ball.radius;
      ball.speedY = -ball.speedY;
    } else if (ball.y + ball.radius > BASE_HEIGHT) {
      ball.y = BASE_HEIGHT - ball.radius;
      ball.speedY = -ball.speedY;
    }

    // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Ä–∞–∫–µ—Ç–∫–∞–º–∏
    if (
      ball.x - ball.radius < paddle1.x + paddle1.width &&
      ball.y > paddle1.y &&
      ball.y < paddle1.y + paddle1.height &&
      ball.speedX < 0
    ) {
      ball.x = paddle1.x + paddle1.width + ball.radius;
      ball.speedX = -ball.speedX;
      let deltaY = ball.y - (paddle1.y + paddle1.height / 2);
      ball.speedY = deltaY * 0.3;
    }

    if (
      ball.x + ball.radius > paddle2.x &&
      ball.y > paddle2.y &&
      ball.y < paddle2.y + paddle2.height &&
      ball.speedX > 0
    ) {
      ball.x = paddle2.x - ball.radius;
      ball.speedX = -ball.speedX;
      let deltaY = ball.y - (paddle2.y + paddle2.height / 2);
      ball.speedY = deltaY * 0.3;
    }

    // –ó–∞–±–∏—Ç—ã–µ –æ—á–∫–∏
    if (ball.x < 0) {
      score2++;
      updateScore();
      resetBall(-1);
    } else if (ball.x > BASE_WIDTH) {
      score1++;
      updateScore();
      resetBall(1);
    }
  }

  // –°–±—Ä–æ—Å –º—è—á–∞ –≤ —Ü–µ–Ω—Ç—Ä —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
  function resetBall(direction) {
    ball.x = BASE_WIDTH / 2;
    ball.y = BASE_HEIGHT / 2;
    ball.speedX = BALL_SPEED * direction;
    ball.speedY = BALL_SPEED * (Math.random() * 2 - 1);
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
  function draw() {
    // –û—á–∏—Å—Ç–∫–∞
    ctx.clearRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

    // –ü–æ–ª–µ
    ctx.fillStyle = '#222';
    ctx.fillRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

    // –¶–µ–Ω—Ç—Ä –ª–∏–Ω–∏—è
    ctx.strokeStyle = '#555';
    ctx.lineWidth = 2;
    ctx.setLineDash([10, 15]);
    ctx.beginPath();
    ctx.moveTo(BASE_WIDTH / 2, 0);
    ctx.lineTo(BASE_WIDTH / 2, BASE_HEIGHT);
    ctx.stroke();
    ctx.setLineDash([]);

    // –†–∞–∫–µ—Ç–∫–∏
    ctx.fillStyle = '#fff';
    ctx.fillRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
    ctx.fillRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);

    // –ú—è—á
    ctx.beginPath();
    ctx.fillStyle = '#fff';
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fill();
  }

  // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  window.addEventListener('keydown', e => {
    keys[e.code] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.code] = false;
  });

  // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–π
  function setupTouchButton(btn, stateKey) {
    btn.addEventListener('touchstart', e => {
      e.preventDefault();
      touchState[stateKey] = true;
    }, {passive: false});
    btn.addEventListener('touchend', e => {
      e.preventDefault();
      touchState[stateKey] = false;
    }, {passive: false});
    btn.addEventListener('touchcancel', e => {
      e.preventDefault();
      touchState[stateKey] = false;
    }, {passive: false});
  }
  setupTouchButton(btnP1Up, 'p1Up');
  setupTouchButton(btnP1Down, 'p1Down');
  setupTouchButton(btnP2Up, 'p2Up');
  setupTouchButton(btnP2Down, 'p2Down');

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–ø—Ä–æ—Å—Ç–∞—è)
  function isMobile() {
    return window.matchMedia("(max-width: 600px)").matches;
  }

  // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–µ–∂–∏–º–æ–º
  function startGame(mode) {
    gameMode = mode;
    menu.style.display = 'none';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    if (isMobile()) {
      touchControls.style.display = 'flex';
      if (mode === 'pvbot') {
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–∫–∞ 2, —Ç.–∫. –±–æ—Ç
        btnP2Up.style.display = 'none';
        btnP2Down.style.display = 'none';
      } else {
        btnP2Up.style.display = 'flex';
        btnP2Down.style.display = 'flex';
      }
    } else {
      touchControls.style.display = 'none';
    }

    initObjects();
    loop();
  }

  // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
  btnPvP.addEventListener('click', () => startGame('pvp'));
  btnPvBot.addEventListener('click', () => startGame('pvbot'));

  // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ ‚Äî –ø—Ä—è—á–µ–º —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –Ω–µ –º–æ–±–∏–ª—å–Ω—ã–π
  window.addEventListener('resize', () => {
    if (!isMobile()) {
      touchControls.style.display = 'none';
    }
  });
})();
</script>

</body>
</html>
