<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ping Pong</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #f0f0f0;
    display: flex; justify-content: center; align-items: center;
    user-select: none;
  }
  #gameCanvas {
    background: #222;
    display: block;
    border-radius: 8px;
    max-width: 95vw;
    max-height: 90vh;
    width: 100%;
    height: auto;
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // Базовые размеры для расчёта пропорций
  const BASE_WIDTH = 700;
  const BASE_HEIGHT = 400;

  // Параметры ракеток
  const PADDLE_WIDTH = 10;
  const PADDLE_HEIGHT = 80;
  const PADDLE_SPEED = 6;

  // Параметры мяча
  const BALL_RADIUS = 8;
  const BALL_SPEED = 5;

  // Игроки
  let paddle1, paddle2, ball;
  let score1 = 0;
  let score2 = 0;

  // Управление
  const keys = {};

  // Масштаб и размеры
  let scale = 1;
  let WIDTH, HEIGHT;

  function setupSizes() {
    // Рассчитываем масштаб по ширине и высоте окна
    const maxWidth = window.innerWidth * 0.95;
    const maxHeight = window.innerHeight * 0.9;

    const scaleX = maxWidth / BASE_WIDTH;
    const scaleY = maxHeight / BASE_HEIGHT;

    scale = Math.min(scaleX, scaleY);

    WIDTH = BASE_WIDTH * scale;
    HEIGHT = BASE_HEIGHT * scale;

    canvas.width = BASE_WIDTH;
    canvas.height = BASE_HEIGHT;

    canvas.style.width = WIDTH + 'px';
    canvas.style.height = HEIGHT + 'px';
  }

  function initObjects() {
    paddle1 = {
      x: 10,
      y: BASE_HEIGHT / 2 - PADDLE_HEIGHT / 2,
      width: PADDLE_WIDTH,
      height: PADDLE_HEIGHT,
      dy: 0
    };

    paddle2 = {
      x: BASE_WIDTH - 10 - PADDLE_WIDTH,
      y: BASE_HEIGHT / 2 - PADDLE_HEIGHT / 2,
      width: PADDLE_WIDTH,
      height: PADDLE_HEIGHT,
      dy: 0
    };

    ball = {
      x: BASE_WIDTH / 2,
      y: BASE_HEIGHT / 2,
      radius: BALL_RADIUS,
      speedX: BALL_SPEED * (Math.random() < 0.5 ? 1 : -1),
      speedY: BALL_SPEED * (Math.random() * 2 - 1)
    };

    score1 = 0;
    score2 = 0;
  }

  function update() {
    // Движение ракеток
    if (keys['w']) {
      paddle1.dy = -PADDLE_SPEED;
    } else if (keys['s']) {
      paddle1.dy = PADDLE_SPEED;
    } else {
      paddle1.dy = 0;
    }

    if (keys['arrowup']) {
      paddle2.dy = -PADDLE_SPEED;
    } else if (keys['arrowdown']) {
      paddle2.dy = PADDLE_SPEED;
    } else {
      paddle2.dy = 0;
    }

    paddle1.y += paddle1.dy;
    paddle2.y += paddle2.dy;

    // Ограничение ракеток по полю
    paddle1.y = Math.max(0, Math.min(BASE_HEIGHT - paddle1.height, paddle1.y));
    paddle2.y = Math.max(0, Math.min(BASE_HEIGHT - paddle2.height, paddle2.y));

    // Движение мяча
    ball.x += ball.speedX;
    ball.y += ball.speedY;

    // Столкновение с верхом и низом
    if (ball.y - ball.radius < 0 || ball.y + ball.radius > BASE_HEIGHT) {
      ball.speedY = -ball.speedY;
    }

    // Столкновение с ракетками
    if (
      ball.x - ball.radius < paddle1.x + paddle1.width &&
      ball.y > paddle1.y &&
      ball.y < paddle1.y + paddle1.height
    ) {
      ball.speedX = -ball.speedX;
      let deltaY = ball.y - (paddle1.y + paddle1.height / 2);
      ball.speedY = deltaY * 0.3;
      ball.x = paddle1.x + paddle1.width + ball.radius;
    }

    if (
      ball.x + ball.radius > paddle2.x &&
      ball.y > paddle2.y &&
      ball.y < paddle2.y + paddle2.height
    ) {
      ball.speedX = -ball.speedX;
      let deltaY = ball.y - (paddle2.y + paddle2.height / 2);
      ball.speedY = deltaY * 0.3;
      ball.x = paddle2.x - ball.radius;
    }

    // Забитые очки
    if (ball.x < 0) {
      score2++;
      resetBall();
    } else if (ball.x > BASE_WIDTH) {
      score1++;
      resetBall();
    }
  }

  function resetBall() {
    ball.x = BASE_WIDTH / 2;
    ball.y = BASE_HEIGHT / 2;
    ball.speedX = BALL_SPEED * (Math.random() < 0.5 ? 1 : -1);
    ball.speedY = BALL_SPEED * (Math.random() * 2 - 1);
  }

  function draw() {
    // Очистка
    ctx.clearRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

    // Поле
    ctx.fillStyle = '#222';
    ctx.fillRect(0, 0, BASE_WIDTH, BASE_HEIGHT);

    // Центр линия
    ctx.strokeStyle = '#555';
    ctx.lineWidth = 2;
    ctx.setLineDash([10, 15]);
    ctx.beginPath();
    ctx.moveTo(BASE_WIDTH / 2, 0);
    ctx.lineTo(BASE_WIDTH / 2, BASE_HEIGHT);
    ctx.stroke();
    ctx.setLineDash([]);

    // Ракетки
    ctx.fillStyle = '#fff';
    ctx.fillRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
    ctx.fillRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);

    // Мяч
    ctx.beginPath();
    ctx.fillStyle = '#fff';
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fill();

    // Счёт сверху по центру
    ctx.fillStyle = '#fff';
    ctx.font = '28px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${score1} : ${score2}`, BASE_WIDTH / 2, 30);
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  // Обработчики клавиатуры
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  // При изменении размера окна пересчитываем размеры
  window.addEventListener('resize', () => {
    setupSizes();
  });

  // Инициализация
  setupSizes();
  initObjects();
  loop();
})();
</script>

</body>
</html>
